name: 'Setup Auto'
description: 'GitHub Action to install Auto release tool'
author: 'Alexey Alekhin'
inputs:
  version:
    description: 'Version of Auto to install (latest by default)'
    required: false
runs:
  using: composite
  steps:
    - name: Set up GitHub credentials for Auto
      shell: bash
      run: |
        echo "GH_TOKEN=${{ github.token }}" >> $GITHUB_ENV
        git config user.name "github-actions[bot]"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

    - name: Install Auto binary
      shell: bash
      run: |
        platform='linux'
        [ '${{ runner.os }}' == 'macOS' ] && platform='macos'
        [ '${{ runner.os }}' == 'Windows' ] && platform='win.exe'
        name="auto-${platform}"
        tmp="${{ runner.temp }}"

        gh release download ${{ inputs.version }} -R intuit/auto -p "$name.gz" -D "$tmp"
        gunzip "$tmp/$name.gz"
        chmod +x "$tmp/$name"

        mkdir "$HOME/bin"
        mv "$tmp/$name" "$HOME/bin/auto"
        echo "$HOME/bin" >> $GITHUB_PATH

    - name: Check Auto installation
      shell: bash
      run: |
        auto --help
